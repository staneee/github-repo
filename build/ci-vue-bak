name: "buildx"

on:
  push:
    paths:
      - 'src/vue/**'

env:
  GIT_REPO: ${{ vars.IMAGE_REGISTRY_USERNAME }}
  GIT_REPO_TOKEN: ${{ secrets.IMAGE_REGISTRY_PASSWORD }}

jobs:
  build-vue:
    runs-on: ubuntu-22.04
    name: Build vue
    steps:
      # checkout source code
      - uses: actions/checkout@v2
      # login docker registry
      - name: Login to Docker Registry
        uses: docker/login-action@v1
        with:
          registry: ${{env.IMAGE_REGISTRY}}
          username: ${{env.IMAGE_REGISTRY_USERNAME}}
          password: ${{env.IMAGE_REGISTRY_PASSWORD}}
      # checkout source code repo
      - name: build 1
        shell: pwsh
        working-directory: ./build
        run: |
          ./clone-target-repo.ps1
      # build
      - name: build 1
        shell: pwsh
        working-directory: ./build/repo-code
        run: |
          ./build.ps1 -ProjectType "vue" -ProjectName "vue" -ImageName "firebyte-template" `
            -DockerfilePath "./src/vue/Dockerfile"
